короче какой план
у нас есть лист их всех соединений

мы асинхронно обрабатываем сообщения пришедшие и
через libevent по таймеру отправляем запросы
